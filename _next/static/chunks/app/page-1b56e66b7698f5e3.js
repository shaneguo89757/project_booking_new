(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{29184:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>P});var n=s(95155),l=s(12115),r=s(14932),a=s(51647),i=s(20071),o=s(72518),d=s(84423),c=s(66848),u=s(52704),x=s(98702);s(33174),(0,a.E)({weekStartsOn:1});let m={"zh-TW":u.G},g=(0,r.Hz)({format:i.GP,parse:o.qg,startOfWeek:()=>(0,d.k)(new Date,{weekStartsOn:1}),getDay:c.P,locales:m}),h=e=>{let{bookings:t,onDateClick:s,maxStudents:a=7}=e,[d,c]=(0,l.useState)(new Date),[u,m]=(0,l.useState)(!1);(0,l.useEffect)(()=>{let e=()=>{m(window.innerWidth>=1024)};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]);let h=(0,l.useMemo)(()=>t.map(e=>{let t=(0,o.qg)(e.date,"yyyy-MM-dd",new Date),s=e.students.length,n=s>=a;return{title:u?"已預約 ".concat(s," 人"):"".concat(s),start:t,end:t,allDay:!0,resource:{isFull:n,studentCount:s,isClassDay:e.isClassDay}}}),[t,a,u]);return(0,n.jsxs)("div",{className:"bg-white rounded-lg shadow",children:[(0,n.jsxs)("div",{className:"p-4 border-b",children:[(0,n.jsx)("h2",{className:"text-2xl font-semibold text-gray-900 text-center mb-4",children:(0,i.GP)(d,"yyyy年 M月")}),(0,n.jsxs)("div",{className:"flex justify-end items-center space-x-2",children:[(0,n.jsx)("button",{onClick:()=>c(new Date),className:"px-3 py-1.5 text-sm rounded-lg ".concat((e=>{let t=new Date;return e.getDate()===t.getDate()&&e.getMonth()===t.getMonth()&&e.getFullYear()===t.getFullYear()})(d)?"bg-blue-100 text-blue-700":"text-gray-700 hover:bg-gray-100"),children:"今天"}),(0,n.jsx)("button",{onClick:()=>{c(new Date(d.getFullYear(),d.getMonth()-1,1))},className:"px-3 py-1.5 text-sm text-gray-700 hover:bg-gray-100 rounded-lg",children:"上個月"}),(0,n.jsx)("button",{onClick:()=>{c(new Date(d.getFullYear(),d.getMonth()+1,1))},className:"px-3 py-1.5 text-sm text-gray-700 hover:bg-gray-100 rounded-lg",children:"下個月"})]})]}),(0,n.jsx)("div",{className:"h-[600px]",children:(0,n.jsx)(r.Vv,{localizer:g,events:h,view:"month",views:["month"],date:d,onNavigate:e=>{c(e)},toolbar:!1,onSelectSlot:e=>{s(e.start)},selectable:!0,popup:!1,eventPropGetter:e=>{let t=e.resource.isFull;return e.resource.isClassDay?{className:"cursor-default pointer-events-none select-none",style:{backgroundColor:"transparent",color:t?"#B91C1C":"#15803D",border:"none",borderRadius:"0.25rem",padding:"2px"}}:{}},dayPropGetter:e=>{let s=(0,i.GP)(e,"yyyy-MM-dd");return{className:"",style:{backgroundColor:t.some(e=>e.date===s&&e.isClassDay)?"#EFF6FF":"#F9FAFB"}}},components:{event:e=>(0,n.jsxs)("div",{className:"flex items-center justify-center gap-0.5 h-full text-xs",children:[(0,n.jsx)(x.A,{className:"w-3.5 h-3.5"}),(0,n.jsx)("span",{className:"font-medium",children:e.event.title})]})},className:"h-full"})})]})};var y=s(15939),b=s(98212),f=s(86500),p=s(31151),j=s(57765),v=s(29337);let N=e=>{let{isOpen:t,onClose:s,students:r,onAdd:a,existingStudentIds:i}=e,[o,d]=(0,l.useState)(new Set),c=r.filter(e=>!i.includes(e.id)),u=e=>{let t=new Set(o);t.has(e)?t.delete(e):t.add(e),d(t)};return(0,n.jsx)(y.e,{appear:!0,show:t,as:l.Fragment,children:(0,n.jsxs)(b.lG,{as:"div",className:"relative z-20",onClose:s,children:[(0,n.jsx)(y.e.Child,{as:l.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:(0,n.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-25"})}),(0,n.jsx)("div",{className:"fixed inset-0 overflow-y-auto",children:(0,n.jsx)("div",{className:"flex min-h-full items-center justify-center p-4 text-center",children:(0,n.jsx)(y.e.Child,{as:l.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",children:(0,n.jsxs)(b.lG.Panel,{className:"w-full max-w-md transform overflow-hidden rounded-2xl bg-white p-6 text-left align-middle shadow-xl transition-all",children:[(0,n.jsx)(b.lG.Title,{as:"h3",className:"text-lg font-medium leading-6 text-gray-900 mb-2",children:"選擇學生"}),(0,n.jsx)("p",{className:"text-sm text-gray-500 mb-4",children:"可以選擇多位學生一起添加"}),0===c.length?(0,n.jsx)("p",{className:"text-gray-500 text-center py-4",children:"沒有可添加的學生"}):(0,n.jsx)("div",{className:"grid grid-cols-2 gap-2 mb-6",children:c.map(e=>(0,n.jsxs)("button",{onClick:()=>u(e.id),className:"p-2 rounded-lg border text-left relative ".concat(o.has(e.id)?"border-blue-500 bg-blue-50":"border-gray-200 hover:bg-gray-50"),children:[(0,n.jsx)("span",{children:e.name}),o.has(e.id)&&(0,n.jsx)(v.A,{className:"w-4 h-4 absolute right-2 top-1/2 -translate-y-1/2 text-blue-500"})]},e.id))}),(0,n.jsxs)("div",{className:"flex justify-between items-center",children:[(0,n.jsxs)("span",{className:"text-sm text-gray-500",children:["已選擇 ",o.size," 位學生"]}),(0,n.jsxs)("div",{className:"flex space-x-2",children:[(0,n.jsx)("button",{type:"button",className:"inline-flex justify-center rounded-md border border-transparent bg-gray-100 px-4 py-2 text-sm font-medium text-gray-900 hover:bg-gray-200 focus:outline-none focus-visible:ring-2 focus-visible:ring-gray-500 focus-visible:ring-offset-2",onClick:s,children:"取消"}),(0,n.jsx)("button",{type:"button",className:"inline-flex justify-center rounded-md border border-transparent px-4 py-2 text-sm font-medium focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 ".concat(o.size>0?"bg-blue-100 text-blue-900 hover:bg-blue-200 focus-visible:ring-blue-500":"bg-gray-100 text-gray-400 cursor-not-allowed"),onClick:()=>{o.size>0&&(a(Array.from(o)),d(new Set),s())},disabled:0===o.size,children:"添加"})]})]})]})})})})]})})},w=e=>{let{isOpen:t,onClose:s,date:r,students:a,isClassDay:o,onStartClass:d,onCloseClass:c,onRemoveStudent:u,onAddStudent:x,allStudents:m,error:g}=e,[h,v]=(0,l.useState)(!1);return(0,n.jsx)(y.e,{appear:!0,show:t,as:l.Fragment,children:(0,n.jsxs)(b.lG,{as:"div",className:"relative z-10",onClose:s,children:[(0,n.jsx)(y.e.Child,{as:l.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:(0,n.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-25"})}),(0,n.jsx)("div",{className:"fixed inset-0 overflow-y-auto",children:(0,n.jsx)("div",{className:"flex min-h-full items-center justify-center p-4 text-center",children:(0,n.jsx)(y.e.Child,{as:l.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",children:(0,n.jsxs)(b.lG.Panel,{className:"w-full max-w-md transform overflow-hidden rounded-2xl bg-white p-6 text-left align-middle shadow-xl transition-all",children:[(0,n.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,n.jsx)("div",{className:"flex items-center gap-2",children:(0,n.jsxs)(b.lG.Title,{as:"h3",className:"text-lg font-medium leading-6 text-gray-900",children:[(0,i.GP)(r,"yyyy年MM月dd日"),"の課程"]})}),o&&(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("span",{className:"text-sm text-gray-500",children:"今天不想上班..."}),(0,n.jsx)("button",{onClick:c,className:"text-gray-500 hover:text-red-600 p-2 rounded-full hover:bg-red-50 transition-colors",title:"關閉課程",children:(0,n.jsx)(p.A,{className:"w-5 h-5"})})]})]}),g&&(0,n.jsx)("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg text-red-700 text-sm",children:g}),o?(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,n.jsx)("h4",{className:"font-medium text-gray-700",children:"上課學員:"}),(0,n.jsxs)("button",{onClick:()=>v(!0),className:"inline-flex items-center text-sm text-blue-600 hover:text-blue-700",children:[(0,n.jsx)(j.A,{className:"w-4 h-4 mr-1"}),"添加學生"]})]}),(0,n.jsx)("ul",{className:"space-y-2",children:a.map((e,t)=>(0,n.jsxs)("li",{className:"p-2 bg-gray-50 rounded-lg flex justify-between items-center",children:[(0,n.jsx)("span",{children:e}),(0,n.jsx)("button",{onClick:()=>u(e),className:"text-gray-400 text-red-500 p-1 rounded-full bg-red-100 hover:bg-red-300",children:(0,n.jsx)(f.A,{className:"w-4 h-4"})})]},t))})]}):(0,n.jsxs)("div",{className:"text-center py-4",children:[(0,n.jsx)("p",{className:"text-gray-500 mb-4",children:"今日未安排課程"}),(0,n.jsx)("button",{type:"button",className:"inline-flex justify-center rounded-md border border-transparent bg-blue-100 px-4 py-2 text-sm font-medium text-blue-900 hover:bg-blue-200 focus:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-2",onClick:d,children:"今日開課吧!"})]}),(0,n.jsx)("div",{className:"mt-4",children:(0,n.jsx)("button",{type:"button",className:"inline-flex justify-center rounded-md border border-transparent bg-gray-100 px-4 py-2 text-sm font-medium text-gray-900 hover:bg-gray-200 focus:outline-none focus-visible:ring-2 focus-visible:ring-gray-500 focus-visible:ring-offset-2",onClick:s,children:"關閉"})}),(0,n.jsx)(N,{isOpen:h,onClose:()=>v(!1),students:m,onAdd:x,existingStudentIds:m.filter(e=>a.includes(e.name)).map(e=>e.id)})]})})})})]})})},C=e=>{let{isOpen:t,onClose:s,onAdd:r}=e,[a,i]=(0,l.useState)("");return(0,n.jsx)(y.e,{appear:!0,show:t,as:l.Fragment,children:(0,n.jsxs)(b.lG,{as:"div",className:"relative z-10",onClose:s,children:[(0,n.jsx)(y.e.Child,{as:l.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:(0,n.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-25"})}),(0,n.jsx)("div",{className:"fixed inset-0 overflow-y-auto",children:(0,n.jsx)("div",{className:"flex min-h-full items-center justify-center p-4 text-center",children:(0,n.jsx)(y.e.Child,{as:l.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",children:(0,n.jsxs)(b.lG.Panel,{className:"w-full max-w-md transform overflow-hidden rounded-2xl bg-white p-6 text-left align-middle shadow-xl transition-all",children:[(0,n.jsx)(b.lG.Title,{as:"h3",className:"text-lg font-medium leading-6 text-gray-900 mb-4",children:"新增學員"}),(0,n.jsxs)("form",{onSubmit:e=>{e.preventDefault(),a.trim()&&(r(a.trim()),i(""),s())},children:[(0,n.jsx)("div",{className:"mt-2",children:(0,n.jsx)("input",{type:"text",value:a,onChange:e=>i(e.target.value),placeholder:"請輸入學員姓名",className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",required:!0})}),(0,n.jsxs)("div",{className:"mt-4 flex justify-end space-x-2",children:[(0,n.jsx)("button",{type:"button",className:"inline-flex justify-center rounded-md border border-transparent bg-gray-100 px-4 py-2 text-sm font-medium text-gray-900 hover:bg-gray-200 focus:outline-none focus-visible:ring-2 focus-visible:ring-gray-500 focus-visible:ring-offset-2",onClick:s,children:"取消"}),(0,n.jsx)("button",{type:"submit",className:"inline-flex justify-center rounded-md border border-transparent bg-blue-100 px-4 py-2 text-sm font-medium text-blue-900 hover:bg-blue-200 focus:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-2",children:"新增"})]})]})]})})})})]})})},S=[{id:"1",name:"張小明"},{id:"2",name:"李小華"},{id:"3",name:"王小美"}];class k{getMaxStudentsPerClass(){return 7}isClassFull(e){let t=this.getBookings().find(t=>t.date===e);return!!t&&t.students.length>=7}getBookings(){if(!this.isClient)return[];let e=localStorage.getItem(this.BOOKINGS_KEY);return e?JSON.parse(e):[]}setBookings(e){this.isClient&&localStorage.setItem(this.BOOKINGS_KEY,JSON.stringify(e))}addClassDay(e){if(!this.isClient)return;let t=this.getBookings();t.find(t=>t.date===e)||(t.push({date:e,students:[],isClassDay:!0}),this.setBookings(t))}closeClassDay(e){if(!this.isClient)return{success:!1,error:"無法在伺服器端執行此操作"};let t=this.getBookings(),s=t.findIndex(t=>t.date===e);if(-1===s)return{success:!1,error:"找不到該課程"};let n=t[s];return n.students.length>0?{success:!1,error:"無法關閉課程：已有 ".concat(n.students.length," 位學生預約")}:(t.splice(s,1),this.setBookings(t),{success:!0})}addStudentBooking(e,t){if(!this.isClient)return{success:!1,error:"無法在伺服器端執行此操作"};let s=this.getBookings(),n=this.getStudents().find(t=>t.id===e);if(!n)return{success:!1,error:"找不到該學生"};let l=t.filter(e=>this.isClassFull(e));return l.length>0?{success:!1,error:"以下日期課程已額滿：".concat(l.join(", "))}:(t.forEach(e=>{let t=s.find(t=>t.date===e);t?t.students.some(e=>e.id===n.id)||t.students.push(n):s.push({date:e,students:[n],isClassDay:!0})}),this.setBookings(s),{success:!0})}removeStudentFromBooking(e,t){if(!this.isClient)return{success:!1,error:"無法在伺服器端執行此操作"};let s=this.getBookings(),n=s.find(e=>e.date===t);if(!n)return{success:!1,error:"找不到該課程"};let l=n.students.findIndex(t=>t.name===e);return -1===l?{success:!1,error:"找不到該學生"}:(n.students.splice(l,1),this.setBookings(s),{success:!0})}getStudents(){if(!this.isClient)return S;let e=localStorage.getItem(this.STUDENTS_KEY);return e?JSON.parse(e):S}addStudent(e){if(!this.isClient)throw Error("Cannot add student on server side");let t=this.getStudents(),s={id:Date.now().toString(),name:e};return t.push(s),this.setStudents(t),s}deleteStudent(e){if(!this.isClient)return{success:!1,error:"無法在伺服器端執行此操作"};if(this.getBookings().some(t=>t.students.some(t=>t.id===e)))return{success:!1,error:"無法刪除：該學生還有課程預約，請先取消所有預約"};let t=this.getStudents(),s=t.findIndex(t=>t.id===e);return -1===s?{success:!1,error:"找不到該學生"}:(t.splice(s,1),this.setStudents(t),{success:!0})}setStudents(e){this.isClient&&localStorage.setItem(this.STUDENTS_KEY,JSON.stringify(e))}editStudent(e,t){if(!this.isClient)return{success:!1,error:"無法在伺服器端執行此操作"};let s=this.getStudents(),n=s.findIndex(t=>t.id===e);if(-1===n)return{success:!1,error:"找不到該學生"};if(s.some(s=>s.name===t&&s.id!==e))return{success:!1,error:"已存在相同名稱的學生"};s[n].name=t,this.setStudents(s);let l=this.getBookings();return l.forEach(s=>{s.students.forEach(s=>{s.id===e&&(s.name=t)})}),this.setBookings(l),{success:!0}}constructor(){this.BOOKINGS_KEY="bookings",this.STUDENTS_KEY="students",this.isClient=!0,this.isClient&&(this.getBookings().length||this.setBookings([]),this.getStudents().length||this.setStudents(S))}}let F=new k;var D=s(40058),B=s(76124),G=s(15441),M=s(61316);let T=e=>{let{students:t,onAddStudent:s,onEditStudent:r,onDeleteStudent:a}=e,[i,o]=(0,l.useState)(null),{groupedStudents:d,indices:c}=(0,l.useMemo)(()=>{let e={};t.forEach(t=>{let s=t.name.charAt(0);e[s]||(e[s]=[]),e[s].push(t)}),Object.keys(e).forEach(t=>{e[t].sort((e,t)=>e.name.localeCompare(t.name))});let s=Object.keys(e).sort();return{groupedStudents:e,indices:s}},[t]),u=e=>{let t=document.getElementById("index-".concat(e));t&&t.scrollIntoView({behavior:"smooth"}),o(e)};return(0,n.jsxs)("div",{className:"max-w-2xl mx-auto bg-white rounded-lg shadow",children:[(0,n.jsxs)("div",{className:"p-4 border-b flex justify-between items-center",children:[(0,n.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:"學員管理"}),(0,n.jsxs)("button",{onClick:s,className:"inline-flex items-center px-3 py-1.5 rounded-lg bg-blue-100 text-blue-700 hover:bg-blue-200",children:[(0,n.jsx)(D.A,{className:"w-5 h-5 mr-1"}),"新增學員"]})]}),(0,n.jsxs)("div",{className:"flex",children:[(0,n.jsx)("div",{className:"flex-1 overflow-y-auto max-h-[70vh]",children:c.map(e=>(0,n.jsxs)("div",{id:"index-".concat(e),children:[(0,n.jsx)("div",{className:"sticky top-0 bg-gray-50 px-4 py-2 text-sm font-medium text-gray-500",children:e}),(0,n.jsx)("ul",{className:"divide-y divide-gray-100",children:d[e].map(e=>(0,n.jsxs)("li",{className:"px-4 py-3 flex justify-between items-center hover:bg-gray-50",children:[(0,n.jsx)("span",{className:"text-gray-900",children:e.name}),(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[r&&(0,n.jsx)("button",{onClick:()=>r(e),className:"p-1 text-gray-400 hover:text-blue-600 rounded-full hover:bg-blue-50",children:(0,n.jsx)(M.A,{className:"w-4 h-4"})}),a&&(0,n.jsx)("button",{onClick:()=>a(e),className:"p-1 text-gray-400 hover:text-red-600 rounded-full hover:bg-red-50",children:(0,n.jsx)(p.A,{className:"w-4 h-4"})})]})]},e.id))})]},e))}),(0,n.jsx)("div",{className:"w-6 flex flex-col justify-center text-center text-xs font-medium sticky top-0 h-[70vh] bg-white",children:c.map(e=>(0,n.jsx)("button",{className:"py-0.5 ".concat(i===e?"text-blue-600":"text-gray-400 hover:text-gray-900"),onClick:()=>u(e),children:e},e))})]})]})},E=e=>{let{isOpen:t,onClose:s,onSave:r,student:a}=e,[i,o]=(0,l.useState)(a.name);return(0,n.jsx)(y.e,{appear:!0,show:t,as:l.Fragment,children:(0,n.jsxs)(b.lG,{as:"div",className:"relative z-10",onClose:s,children:[(0,n.jsx)(y.e.Child,{as:l.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:(0,n.jsx)("div",{className:"fixed inset-0 bg-black/25"})}),(0,n.jsx)("div",{className:"fixed inset-0 overflow-y-auto",children:(0,n.jsx)("div",{className:"flex min-h-full items-center justify-center p-4 text-center",children:(0,n.jsx)(y.e.Child,{as:l.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",children:(0,n.jsxs)(b.lG.Panel,{className:"w-full max-w-md transform overflow-hidden rounded-2xl bg-white p-6 shadow-xl transition-all",children:[(0,n.jsx)(b.lG.Title,{as:"h3",className:"text-xl font-semibold leading-6 text-gray-900",children:"編輯學員"}),(0,n.jsxs)("form",{onSubmit:e=>{e.preventDefault(),i.trim()&&(r(i.trim()),s())},className:"mt-6",children:[(0,n.jsx)("div",{className:"space-y-4",children:(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700 mb-2",children:"學員姓名"}),(0,n.jsx)("input",{type:"text",name:"name",id:"name",value:i,onChange:e=>o(e.target.value),className:"block w-full rounded-lg border-gray-300 py-3 px-4 text-gray-900 shadow-sm focus:border-blue-500 focus:ring-blue-500",placeholder:"請輸入學員姓名"})]})}),(0,n.jsxs)("div",{className:"mt-8 flex justify-end gap-3",children:[(0,n.jsx)("button",{type:"button",className:"inline-flex justify-center rounded-lg border border-gray-300 bg-white px-5 py-2.5 text-sm font-semibold text-gray-700 shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2",onClick:s,children:"取消"}),(0,n.jsx)("button",{type:"submit",className:"inline-flex justify-center rounded-lg border border-transparent bg-blue-600 px-5 py-2.5 text-sm font-semibold text-white shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2",children:"儲存"})]})]})]})})})})]})})},O=e=>{let{bookings:t}=e,s=t.filter(e=>e.isClassDay).sort((e,t)=>new Date(e.date).getTime()-new Date(t.date).getTime());return 0===s.length?(0,n.jsx)("div",{className:"text-center text-gray-500 py-8",children:"目前沒有開課的日期"}):(0,n.jsx)("div",{className:"max-w-2xl mx-auto bg-white rounded-lg shadow divide-y",children:s.map(e=>(0,n.jsxs)("div",{className:"p-4",children:[(0,n.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:(0,i.GP)(new Date(e.date),"yyyy-MM-dd")}),e.students.length>0?(0,n.jsx)("ul",{className:"space-y-1 pl-4",children:e.students.map((e,t)=>(0,n.jsxs)("li",{className:"text-gray-600",children:["- ",e]},t))}):(0,n.jsx)("p",{className:"text-gray-500 pl-4",children:"尚無學生預約"})]},e.date))})};function P(){var e;let[t,s]=(0,l.useState)("calendar"),[r,a]=(0,l.useState)("grid"),[o,d]=(0,l.useState)(null),[c,u]=(0,l.useState)([]),[x,m]=(0,l.useState)(!1),[g,y]=(0,l.useState)(!1),[b,f]=(0,l.useState)([]),[p,j]=(0,l.useState)(null),[v,N]=(0,l.useState)(null);(0,l.useEffect)(()=>{m(!0)},[]),(0,l.useEffect)(()=>{x&&(u(F.getBookings()),f(F.getStudents()))},[x]);let S=async()=>{if(!o)return;let e=(0,i.GP)(o,"yyyy-MM-dd");F.addClassDay(e),u(F.getBookings()),d(null)},k=async()=>{if(!o)return;let e=(0,i.GP)(o,"yyyy-MM-dd"),t=F.closeClassDay(e);t.success?(u(F.getBookings()),d(null),j(null)):j(t.error||"關閉課程失敗")},M=(e,t)=>{let s=(0,i.GP)(t,"yyyy-MM-dd"),n=F.removeStudentFromBooking(e,s);n.success?(u(F.getBookings()),j(null)):j(n.error||"移除學生失敗")},P=(e,t)=>{let s=(0,i.GP)(t,"yyyy-MM-dd"),n=F.addStudentBooking(e[0],[s]);if(n.success&&e.length>1)for(let t=1;t<e.length;t++){let n=F.addStudentBooking(e[t],[s]);if(!n.success){j(n.error||"部分學生添加失敗");break}}n.success?(u(F.getBookings()),j(null)):j(n.error||"添加學生失敗")},A=c.map(e=>({date:e.date,students:e.students.map(e=>e.name),isClassDay:e.isClassDay}));return x?(0,n.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,n.jsx)("header",{className:"bg-white shadow",children:(0,n.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4",children:(0,n.jsxs)("div",{className:"flex justify-between items-center",children:[(0,n.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"課程預約系統"}),(0,n.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,n.jsxs)("button",{onClick:()=>y(!0),className:"inline-flex items-center px-4 py-2 rounded-lg bg-green-100 text-green-700 hover:bg-green-200",children:[(0,n.jsx)(D.A,{className:"w-5 h-5 mr-2"}),"新增學員"]}),(0,n.jsxs)("div",{className:"space-x-4",children:[(0,n.jsx)("button",{onClick:()=>s("calendar"),className:"px-4 py-2 rounded-lg ".concat("calendar"===t?"bg-blue-500 text-white":"bg-gray-100 text-gray-700"),children:"行事曆"}),(0,n.jsx)("button",{onClick:()=>s("students"),className:"px-4 py-2 rounded-lg ".concat("students"===t?"bg-blue-500 text-white":"bg-gray-100 text-gray-700"),children:"學員管理"})]})]})]})})}),(0,n.jsxs)("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:["calendar"===t?(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"mb-4 flex justify-end",children:(0,n.jsxs)("div",{className:"inline-flex rounded-lg shadow-sm",children:[(0,n.jsxs)("button",{onClick:()=>a("grid"),className:"inline-flex items-center px-3 py-2 rounded-l-lg border ".concat("grid"===r?"bg-blue-50 border-blue-500 text-blue-700":"bg-white border-gray-300 text-gray-700 hover:bg-gray-50"),children:[(0,n.jsx)(B.A,{className:"w-5 h-5 mr-2"}),"月曆"]}),(0,n.jsxs)("button",{onClick:()=>a("list"),className:"inline-flex items-center px-3 py-2 rounded-r-lg border-t border-r border-b -ml-px ".concat("list"===r?"bg-blue-50 border-blue-500 text-blue-700":"bg-white border-gray-300 text-gray-700 hover:bg-gray-50"),children:[(0,n.jsx)(G.A,{className:"w-5 h-5 mr-2"}),"列表"]})]})}),"grid"===r?(0,n.jsx)(h,{bookings:A,onDateClick:e=>{d(e)},maxStudents:F.getMaxStudentsPerClass()}):(0,n.jsx)(O,{bookings:A})]}):(0,n.jsx)(T,{students:b,onAddStudent:()=>y(!0),onEditStudent:e=>{N(e)},onDeleteStudent:e=>{if(confirm("確定要刪除學生 ".concat(e.name," 嗎？"))){let t=F.deleteStudent(e.id);t.success?f(F.getStudents()):alert(t.error)}}}),o&&(0,n.jsx)(w,{isOpen:!!o,onClose:()=>{d(null),j(null)},date:o,students:(null===(e=c.find(e=>e.date===(0,i.GP)(o,"yyyy-MM-dd")))||void 0===e?void 0:e.students.map(e=>e.name))||[],isClassDay:c.some(e=>e.date===(0,i.GP)(o,"yyyy-MM-dd")),onStartClass:S,onCloseClass:k,onRemoveStudent:e=>M(e,o),onAddStudent:e=>P(e,o),allStudents:b,error:p}),(0,n.jsx)(C,{isOpen:g,onClose:()=>y(!1),onAdd:e=>{F.addStudent(e),f(F.getStudents())}}),v&&(0,n.jsx)(E,{isOpen:!!v,onClose:()=>N(null),onSave:e=>{if(!v)return;let t=F.editStudent(v.id,e);t.success?(f(F.getStudents()),u(F.getBookings())):alert(t.error),N(null)},student:v})]})]}):null}},63039:(e,t,s)=>{Promise.resolve().then(s.bind(s,29184))}},e=>{var t=t=>e(e.s=t);e.O(0,[431,586,417,441,684,358],()=>t(63039)),_N_E=e.O()}]);